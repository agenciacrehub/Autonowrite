{% extends "wizard/base_wizard.html" %}

{% block wizard_title %}Fontes e Referências{% endblock %}

{% block wizard_description %}
Especifique as fontes de referência e requisitos de citação para o conteúdo.
{% endblock %}

{% block wizard_content %}
<form method="POST" class="needs-validation" novalidate>
    {{ form.hidden_tag() }}
    
    <div class="form-group mb-4">
        {{ form.preferred_sources.label(class="form-label") }}
        {{ form.preferred_sources(class="form-control" + (' is-invalid' if form.preferred_sources.errors else ''), 
                               rows="3",
                               placeholder="Ex: Artigos científicos, livros acadêmicos, sites confiáveis"
                              ) }}
        <div class="invalid-feedback">
            {{ form.preferred_sources.errors[0] if form.preferred_sources.errors }}
        </div>
        <small class="form-text text-muted">
            Tipos de fontes que devem ser priorizadas. Separe com vírgulas ou em linhas diferentes.
        </small>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <div class="form-group mb-4">
                {{ form.key_authors.label(class="form-label") }}
                {{ form.key_authors(class="form-control" + (' is-invalid' if form.key_authors.errors else ''), 
                                 placeholder="Ex: Stephen Hawking, Albert Einstein"
                                ) }}
                <div class="invalid-feedback">
                    {{ form.key_authors.errors[0] if form.key_authors.errors }}
                </div>
                <small class="form-text text-muted">
                    Autores ou especialistas que devem ser referenciados.
                </small>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="form-group mb-4">
                {{ form.time_period.label(class="form-label") }}
                {{ form.time_period(class="form-control" + (' is-invalid' if form.time_period.errors else ''), 
                                  placeholder="Ex: Últimos 5 anos, Década de 2010, Século XX"
                                 ) }}
                <div class="invalid-feedback">
                    {{ form.time_period.errors[0] if form.time_period.errors }}
                </div>
                <small class="form-text text-muted">
                    Período temporal das fontes, se relevante.
                </small>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <div class="form-check form-switch mb-4">
                {{ form.citations_required(class="form-check-input" + (' is-invalid' if form.citations_required.errors else '')) }}
                {{ form.citations_required.label(class="form-check-label") }}
                <div class="invalid-feedback">
                    {{ form.citations_required.errors[0] if form.citations_required.errors }}
                </div>
                <small class="form-text text-muted d-block">
                    Se ativado, todas as afirmações factuais devem incluir citações.
                </small>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="form-group">
                {{ form.min_sources.label(class="form-label") }}
                {{ form.min_sources(class="form-control" + (' is-invalid' if form.min_sources.errors else ''), 
                                  type="number",
                                  min="0",
                                  max="20"
                                 ) }}
                <div class="invalid-feedback">
                    {{ form.min_sources.errors[0] if form.min_sources.errors }}
                </div>
                <small class="form-text text-muted">
                    Número mínimo de fontes diferentes que devem ser utilizadas.
                </small>
            </div>
        </div>
    </div>
    
    <!-- Navigation buttons -->
    <div class="d-flex justify-content-between mt-4">
        <div>
            <button type="submit" name="back" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i> Voltar
            </button>
        </div>
        <div>
            <button type="submit" name="next" class="btn btn-primary">
                Próximo <i class="fas fa-arrow-right ms-1"></i>
            </button>
            <button type="submit" name="save_draft" class="btn btn-outline-secondary ms-2">
                <i class="far fa-save me-1"></i>Salvar Rascunho
            </button>
        </div>
    </div>
</form>
{% endblock %}

{% block extra_js %}
<script>
// Enable Bootstrap form validation
(function () {
    'use strict'
    
    // Fetch all the forms we want to apply custom Bootstrap validation styles to
    var forms = document.querySelectorAll('.needs-validation')
    
    // Loop over them and prevent submission
    Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            
            form.classList.add('was-validated')
        }, false)
    })
})()
</script>
{% endblock %}
